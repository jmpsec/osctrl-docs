<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="description" content="Documentation for osctrl: Fast and efficient osquery management">
<meta name="author" content="Javier Marcos de Prado, JMPSec">

    <link rel="icon" href="/favicon.png" type="image/png">

    <title>osctrl-tls :: osctrl: Fast and efficient osquery management</title>

    
    <link href="/css/nucleus.css?1610381788" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1610381788" rel="stylesheet">
    <link href="/css/hybrid.css?1610381788" rel="stylesheet">
    <link href="/css/featherlight.min.css?1610381788" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1610381788" rel="stylesheet">
    <link href="/css/auto-complete.css?1610381788" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1610381788" rel="stylesheet">
    <link href="/css/theme.css?1610381788" rel="stylesheet">
    <link href="/css/hugo-theme.css?1610381788" rel="stylesheet">
    
      <link href="/css/theme-osctrl.css?1610381788" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1610381788"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144353364-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144353364-2');
</script>

<style>
@import url('https://fonts.googleapis.com/css?family=Bai+Jamjuree&display=swap');

.jmpsec {
    height: 5em;
    width: auto;
    margin: auto;
    bottom: 3em;
    left: 0;
    right: 0;
    border: 2px solid black;
    border-bottom: 4px solid black;
    border-radius: 5px;
    box-shadow: 0 5px 5px 0 rgba(0, 0, 0, 0.5);
    transition: all 200ms ease-out;
    background-color: #ffffff;
}

.jmpsec:hover {
  box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
  transform: scale(1.5);
}
</style>

  </head>
  <body class="" data-url="/components/osctrl-tls/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
  <h1 style="margin:0; padding:0">
    <img src="/logo.png" style="width: 65%" alt="osctrl"/>
  </h1>

</a>

<center>
  <a href="https://github.com/jmpsec/osctrl/releases/latest">
    <img alt="Release" src="https://img.shields.io/github/release/jmpsec/osctrl.svg?style=flat-square">
  </a>
</center>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1610381788"></script>
<script type="text/javascript" src="/js/auto-complete.js?1610381788"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/osctrl.net\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1610381788"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/components/" title="Components" class="dd-item 
        parent
        
        
        ">
      <a href="/components/">
          <b>1. </b>Components
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/components/osctrl-tls/" title="osctrl-tls" class="dd-item 
        parent
        active
        
        ">
      <a href="/components/osctrl-tls/">
          osctrl-tls
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/osctrl-api/" title="osctrl-api" class="dd-item 
        
        
        
        ">
      <a href="/components/osctrl-api/">
          osctrl-api
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/osctrl-admin/" title="osctrl-admin" class="dd-item 
        
        
        
        ">
      <a href="/components/osctrl-admin/">
          osctrl-admin
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/osctrl-cli/" title="osctrl-cli" class="dd-item 
        
        
        
        ">
      <a href="/components/osctrl-cli/">
          osctrl-cli
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/nginx/" title="nginx" class="dd-item 
        
        
        
        ">
      <a href="/components/nginx/">
          nginx
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/backend/" title="Backend" class="dd-item 
        
        
        
        ">
      <a href="/components/backend/">
          Backend
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/components/metrics/" title="Metrics" class="dd-item 
        
        
        
        ">
      <a href="/components/metrics/">
          Metrics
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/deployment/" title="Deployment" class="dd-item 
        
        
        
        ">
      <a href="/deployment/">
          <b>2. </b>Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/deployment/vagrant/" title="Using Vagrant" class="dd-item 
        
        
        
        ">
      <a href="/deployment/vagrant/">
          Using Vagrant
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/deployment/docker/" title="Using Docker" class="dd-item 
        
        
        
        ">
      <a href="/deployment/docker/">
          Using Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/deployment/natively/" title="Using provision.sh" class="dd-item 
        
        
        
        ">
      <a href="/deployment/natively/">
          Using provision.sh
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/configuration/" title="Configuration" class="dd-item 
        
        
        
        ">
      <a href="/configuration/">
          <b>3. </b>Configuration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/usage/" title="Usage" class="dd-item 
        
        
        
        ">
      <a href="/usage/">
          <b>4. </b>Usage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-tls/" title="osctrl-tls" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-tls/">
          osctrl-tls
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-api/" title="osctrl-api" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-api/">
          osctrl-api
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-admin/" title="osctrl-admin" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-admin/">
          osctrl-admin
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/" title="osctrl-cli" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/">
          osctrl-cli
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/user/" title="user" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/user/">
          user
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/environment/" title="environment" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/environment/">
          environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/tag/" title="tag" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/tag/">
          tag
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/settings/" title="settings" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/settings/">
          settings
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/node/" title="node" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/node/">
          node
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/query/" title="query" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/query/">
          query
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/osctrl-cli/check/" title="check" class="dd-item 
        
        
        
        ">
      <a href="/usage/osctrl-cli/check/">
          check
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/provision.sh/" title="provision.sh" class="dd-item 
        
        
        
        ">
      <a href="/usage/provision.sh/">
          provision.sh
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/usage/dockerize.sh/" title="dockerize.sh" class="dd-item 
        
        
        
        ">
      <a href="/usage/dockerize.sh/">
          dockerize.sh
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/contributing/" title="Contributing" class="dd-item 
        
        
        
        ">
      <a href="/contributing/">
          <b>5. </b>Contributing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/jmpsec/osctrl"><i class='fab fa-github'></i> Github repo - osctrl</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://osctrl.net/"><center><a class="github-button" href="https://github.com/jmpsec/osctrl" data-icon="octicon-star" data-show-count="true" aria-label="Star jmpsec/osctrl on GitHub">Star</a> <a class="github-button" href="https://github.com/jmpsec/osctrl/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork jmpsec/osctrl on GitHub">Fork</a><center></a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/jmpsec/osctrl/blob/master/LICENSE"><br/><img alt="Software License" src="https://img.shields.io/badge/license-MIT-green?style=flat-square&fuckgithubcache=1"></a>
              </li>
          
              <li> 
                  <a class="padding" href="https://travis-ci.org/jmpsec/osctrl"><img alt="Travis" src="https://img.shields.io/travis/jmpsec/osctrl/master.svg?style=flat-square"></a>
              </li>
          
              <li> 
                  <a class="padding" href="https://goreportcard.com/report/github.com/jmpsec/osctrl"><img alt="Go Report Card" src="https://goreportcard.com/badge/github.com/jmpsec/osctrl?style=flat-square&fuckgithubcache=1"></a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <script async defer src="https://buttons.github.io/buttons.js"></script>

<center>
  <a href="https://jmpsec.com" target="_blank">
    <img class="jmpsec" src="/jmpsec.png" alt="JMP Security"/>
  </a>
</center>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/jmpsec/osctrl-docs/edit/master/content/components/osctrl-tls/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/components/'>Components</a> > osctrl-tls
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              osctrl-tls
            </h1>
          

        




	<p align="center">
  <img src="/osctrl-tls.png" style="width:75%; margin: 0;"/>
</p>
<hr>
<p>The osctrl-tls component is the actual TLS endpoint that implements the <a href="https://osquery.readthedocs.io/en/stable/deployment/remote/">remote API</a> of <a href="https://osquery.io">osquery</a>.</p>
<p>Inside of the osctrl-tls, you can run a number of TLS endpoints, to group the nodes that will enroll in each of them. Within <strong>osctrl</strong> this concept is called an <strong>environment</strong>.</p>
<p>Each <strong>environment</strong> implements handlers to manage the following actions:</p>
<ul>
<li>Enroll nodes,</li>
<li>Serve osquery configuration to enrolled nodes,</li>
<li>Log osquery status messages and osquery results from enrolled nodes,</li>
<li>Run on-demand queries in enrolled nodes and collect results,</li>
<li>Perform file carving operations in enrolled nodes.</li>
</ul>
<p>Inside <strong>osctrl</strong> there can be <em>many</em> environments, like a typical environment where you have corporate and production systems. Then you would have one environment for corp, and another one for prod. The reasoning is, if you may need to distribute different configurations to the enrolled nodes, then you should use different environments.</p>
<h4 id="enrolling-osquery-nodes">Enrolling osquery nodes</h4>
<p>As mentioned before, osquery nodes must be enrolled inside of an environment. In order to achieve that, osquery requires an enrolling secret that will be stored in disk. Also, and given that osquery communicates with <strong>osctrl</strong> using TLS, a certificate may also be needed.</p>
<p>For example, here are the flags to enroll osquery nodes in the <em>dev</em> environment, used as example when deploying <strong>osctrl</strong> locally. The important part are the path for the different requests to arrive and the intervals in secods:</p>
<pre><code class="language-properties" data-lang="properties">--host_identifier=uuid
--force=true
--utc=true
--enroll_secret_path=__SECRET_FILE__
--enroll_tls_endpoint=/dev/enroll
--config_plugin=tls
--config_tls_endpoint=/dev/config
--config_tls_refresh=300
--config_tls_max_attempts=5
--logger_plugin=tls
--logger_tls_compress=true
--logger_tls_endpoint=/dev/log
--logger_tls_period=600
--disable_carver=false
--carver_disable_function=false
--carver_start_endpoint=/dev/init
--carver_continue_endpoint=/dev/block
--disable_distributed=false
--distributed_interval=60
--distributed_plugin=tls
--distributed_tls_max_attempts=3
--distributed_tls_read_endpoint=/dev/read
--distributed_tls_write_endpoint=/dev/write
--tls_dump=true
--tls_hostname=osctrl-nginx
--tls_server_certs=__CERT_FILE__
</code></pre><p>The values of <code>__CERT_FILE__</code> and <code>__SECRET_FILE__</code> will be the local full path for certificate and secret respectively.</p>
<h4 id="escaling-osctrl-tls">Escaling osctrl-tls</h4>
<p>The idea behind making osctrl-tls its own component is all about scalability. In a scenario with many nodes enrolled, the number of requests is going to increase quickly, especially if we lower the intervals.</p>
<p>Running multiple instances of osctrl-tls will help to scale the service and be reliable for a larger number of nodes.</p>
<p>For example, using the intervals of the flags above, where logs, configuration and queries run every 600, 300 and 60 seconds. Presuming that you have 1000 machines and you want to enroll them all in <strong>osctrl</strong></p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/components/" title="Components"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/components/osctrl-api/" title="osctrl-api" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1610381788"></script>
    <script src="/js/perfect-scrollbar.min.js?1610381788"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1610381788"></script>
    <script src="/js/jquery.sticky.js?1610381788"></script>
    <script src="/js/featherlight.min.js?1610381788"></script>
    <script src="/js/html5shiv-printshiv.min.js?1610381788"></script>
    <script src="/js/highlight.pack.js?1610381788"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1610381788"></script>
    <script src="/js/learn.js?1610381788"></script>
    <script src="/js/hugo-learn.js?1610381788"></script>

    <link href="/mermaid/mermaid.css?1610381788" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1610381788"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
